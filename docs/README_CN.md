# 设备数字护照溯源管理系统

**版本:** V1.0.0
**发布日期:** 2026年1月
**开发单位:** [您的公司名称]

---

## 一、系统概述

### 1.1 系统简介

设备数字护照溯源管理系统是一款面向机电自动化设备行业的B2B全生命周期管理平台。系统通过为每台设备生成唯一的数字护照码（类似设备的"身份证"），实现设备从采购、质检、组装、测试、物流到售后服务的全流程追溯。

### 1.2 系统定位

- **目标行业:** 机电自动化设备贸易与服务
- **核心功能:** 设备数字护照、B2B撮合交易、全生命周期追溯
- **用户群体:** 设备供应商、采购商、服务工程师、终端客户

### 1.3 技术架构

| 层级 | 技术选型 |
|------|----------|
| 前端框架 | React 18 + TypeScript + Tailwind CSS |
| 后端框架 | NestJS + TypeORM |
| 数据库 | PostgreSQL 16 |
| 缓存服务 | Redis 7 |
| 身份认证 | JWT + RBAC角色权限 |
| API文档 | Swagger/OpenAPI |
| 包管理器 | pnpm + Turborepo |

---

## 二、功能模块

### 2.1 设备数字护照模块

#### 2.1.1 护照码格式
```
DP-{公司代码}-{年份}-{产品线}-{产地}-{序列号}-{校验码}
示例: DP-MED-2025-PLC-DE-000001-A7
```

#### 2.1.2 产品线代码
| 代码 | 产品类型 |
|------|----------|
| PLC | 可编程逻辑控制器 |
| MOT | 电机/驱动器 |
| SEN | 传感器 |
| CTL | 控制器 |
| ROB | 机器人 |
| HMI | 人机界面 |

#### 2.1.3 设备状态流转
```
CREATED → PROCURED → IN_QC → QC_PASSED → IN_ASSEMBLY →
IN_TESTING → TEST_PASSED → PACKAGED → IN_TRANSIT → DELIVERED → IN_SERVICE
```

### 2.2 B2B撮合交易模块

#### 2.2.1 公海市场
- **产品发布:** 供应商可将产品发布到公海市场
- **需求发布:** 采购商可发布采购需求(RFQ)
- **搜索筛选:** 支持品类、价格、地区等多维筛选

#### 2.2.2 智能匹配引擎
采用多维度评分算法，自动撮合买卖双方：

| 评分维度 | 权重 | 说明 |
|----------|------|------|
| 地理距离 | 25分 | 优先推荐距离近的供应商 |
| 品类匹配 | 20分 | 产品类别匹配度 |
| HS编码 | 20分 | 海关编码匹配 |
| 价格兼容 | 15分 | 预算与报价重叠度 |
| 文本相似 | 10分 | 需求描述相似度 |
| 频率匹配 | 10分 | 采购频率匹配 |

#### 2.2.3 询盘沟通系统
- 买卖双方在线沟通
- 报价/还价流程
- 消息实时通知
- 状态跟踪(待回复→洽谈中→已成交/已拒绝)

### 2.3 用户认证模块

#### 2.3.1 注册类型
- **公司注册:** 供应商/采购商企业认证
- **专家注册:** 技术专家/商务专家个人认证

#### 2.3.2 角色权限
| 角色 | 权限级别 | 功能范围 |
|------|----------|----------|
| PUBLIC | 1 | 查看公开信息、提交服务请求 |
| CUSTOMER | 2 | 查看设备详情、服务历史 |
| ENGINEER | 3 | 执行服务工单、访问技术手册 |
| QC_INSPECTOR | 4 | 更新质检状态 |
| OPERATOR | 5 | 创建设备、管理订单 |
| ADMIN | 6 | 系统完全访问权限 |

### 2.4 服务请求模块

- **护照码可选:** 支持无护照码的服务请求
- **附件上传:** 上传图片/文档描述问题
- **地图选点:** 可视化选择服务地址
- **自动派单:** 根据位置匹配最近工程师

### 2.5 文件管理模块

- 支持图片(JPG/PNG/GIF/WebP)
- 支持文档(PDF/DOC/DOCX)
- 文件分类管理
- 安全访问控制

---

## 三、数据库设计

### 3.1 核心实体

#### 设备护照 (device_passports)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| passport_code | VARCHAR | 护照码(唯一) |
| product_type_id | UUID | 产品类型 |
| manufacturer_id | UUID | 制造商 |
| status | ENUM | 设备状态 |
| qr_code_url | VARCHAR | 二维码URL |

#### 组织 (organizations)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| name | VARCHAR | 组织名称 |
| code | VARCHAR(3) | 组织代码 |
| type | ENUM | 组织类型 |

#### 用户 (users)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| email | VARCHAR | 邮箱(唯一) |
| password | VARCHAR | 密码(加密) |
| role | ENUM | 用户角色 |
| organization_id | UUID | 所属组织 |

#### 市场产品 (marketplace_products)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| listing_title | VARCHAR | 产品标题 |
| min_price | DECIMAL | 最低价格 |
| max_price | DECIMAL | 最高价格 |
| status | ENUM | 发布状态 |

#### 采购需求 (buyer_requirements)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| title | VARCHAR | 需求标题 |
| budget_min | DECIMAL | 预算下限 |
| budget_max | DECIMAL | 预算上限 |
| status | ENUM | 需求状态 |

#### 询盘 (inquiries)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| inquiry_code | VARCHAR | 询盘编号 |
| buyer_org_id | UUID | 采购方 |
| supplier_org_id | UUID | 供应方 |
| status | ENUM | 询盘状态 |

### 3.2 实体关系图

```
Organization (组织)
    │
    ├── 1:N ── User (用户)
    │
    ├── 1:N ── DevicePassport (设备护照)
    │
    ├── 1:N ── SupplierProduct (供应商产品)
    │              │
    │              └── 1:1 ── MarketplaceProduct (市场发布)
    │
    ├── 1:N ── BuyerRequirement (采购需求)
    │
    └── N:M ── Inquiry (询盘)
                   │
                   └── 1:N ── InquiryMessage (消息)
```

---

## 四、API接口

### 4.1 认证接口

| 方法 | 端点 | 说明 |
|------|------|------|
| POST | /api/v1/auth/login | 用户登录 |
| POST | /api/v1/registration/company | 公司注册 |
| POST | /api/v1/registration/expert | 专家注册 |

### 4.2 设备护照接口

| 方法 | 端点 | 说明 |
|------|------|------|
| GET | /api/v1/scan/:code | 扫码查询(公开) |
| GET | /api/v1/passports | 护照列表 |
| POST | /api/v1/passports | 创建护照 |
| PATCH | /api/v1/passports/:id/status | 更新状态 |

### 4.3 B2B市场接口

| 方法 | 端点 | 说明 |
|------|------|------|
| GET | /api/v1/marketplace/products | 产品列表 |
| POST | /api/v1/marketplace/products | 发布产品 |
| GET | /api/v1/marketplace/requirements | 需求列表 |
| POST | /api/v1/marketplace/requirements | 发布需求 |

### 4.4 询盘接口

| 方法 | 端点 | 说明 |
|------|------|------|
| GET | /api/v1/inquiries | 询盘列表 |
| POST | /api/v1/inquiries | 创建询盘 |
| POST | /api/v1/inquiries/:id/messages | 发送消息 |

### 4.5 服务请求接口

| 方法 | 端点 | 说明 |
|------|------|------|
| POST | /api/v1/service-orders/public-request | 公开服务请求 |
| GET | /api/v1/service-orders | 工单列表 |

---

## 五、安全设计

### 5.1 身份认证
- JWT Token认证
- Token有效期7天
- 密码BCrypt加密存储

### 5.2 权限控制
- 基于角色的访问控制(RBAC)
- API级别权限验证
- 数据级别权限隔离

### 5.3 数据安全
- HTTPS传输加密
- 敏感数据加密存储
- SQL注入防护
- XSS攻击防护

---

## 六、部署架构

### 6.1 开发环境
```
┌─────────────┐     ┌─────────────┐
│  Web前端    │────▶│  API服务    │
│  (React)    │     │  (NestJS)   │
│  :5173      │     │  :3000      │
└─────────────┘     └─────────────┘
                           │
              ┌────────────┼────────────┐
              ▼            ▼            ▼
       ┌──────────┐ ┌──────────┐ ┌──────────┐
       │PostgreSQL│ │  Redis   │ │  文件存储 │
       │  :5432   │ │  :6379   │ │ /uploads │
       └──────────┘ └──────────┘ └──────────┘
```

### 6.2 生产环境
```
                    ┌─────────────┐
                    │   Nginx     │
                    │ (反向代理)   │
                    └─────────────┘
                           │
              ┌────────────┼────────────┐
              ▼            ▼            ▼
       ┌──────────┐ ┌──────────┐ ┌──────────┐
       │ Web静态  │ │ API集群  │ │ OSS存储  │
       │  资源    │ │ (PM2)    │ │ (文件)   │
       └──────────┘ └──────────┘ └──────────┘
                           │
              ┌────────────┼────────────┐
              ▼            ▼            ▼
       ┌──────────┐ ┌──────────┐ ┌──────────┐
       │ RDS      │ │ Redis    │ │ 日志服务 │
       │PostgreSQL│ │ 云缓存   │ │          │
       └──────────┘ └──────────┘ └──────────┘
```

---

## 七、系统要求

### 7.1 服务器配置

| 配置项 | 最低要求 | 推荐配置 |
|--------|----------|----------|
| CPU | 2核 | 4核 |
| 内存 | 4GB | 8GB |
| 硬盘 | 50GB SSD | 200GB SSD |
| 带宽 | 5Mbps | 10Mbps |

### 7.2 软件环境

| 软件 | 版本要求 |
|------|----------|
| Node.js | 18.x 或 20.x |
| PostgreSQL | 14.x 或 16.x |
| Redis | 6.x 或 7.x |
| Nginx | 1.18+ |

---

## 八、版本信息

| 版本 | 发布日期 | 更新内容 |
|------|----------|----------|
| V1.0.0 | 2026-01 | 首次发布，包含核心功能模块 |

---

## 九、联系方式

- **技术支持:** [邮箱地址]
- **官方网站:** [网站地址]
- **文档中心:** [文档地址]

---

**版权所有 © 2026 [您的公司名称] 保留所有权利**
