# 设备数字护照溯源管理系统 V1.0

# 软件说明书

---

**软件名称:** 设备数字护照溯源管理系统
**软件简称:** 设备护照系统
**版本号:** V1.0
**开发完成日期:** 2026年1月
**著作权人:** [您的公司全称]

---

## 目录

1. 引言
2. 软件概述
3. 运行环境
4. 功能说明
5. 操作说明
6. 数据字典
7. 出错处理

---

## 1. 引言

### 1.1 编写目的

本说明书详细描述了"设备数字护照溯源管理系统V1.0"的功能、性能、运行环境及操作方法，为软件著作权登记提供技术文档支持。

### 1.2 软件背景

随着工业4.0和智能制造的发展，机电自动化设备的全生命周期管理需求日益增长。本系统通过为每台设备生成唯一的数字护照，实现设备从生产到报废的全流程追溯，解决了传统设备管理中信息分散、追溯困难的问题。

### 1.3 定义和缩略语

| 术语 | 定义 |
|------|------|
| 数字护照 | 设备的唯一身份标识码，包含设备全部信息 |
| B2B | 企业对企业的商业模式 |
| RFQ | Request for Quotation，询价请求 |
| JWT | JSON Web Token，身份认证令牌 |
| RBAC | 基于角色的访问控制 |

---

## 2. 软件概述

### 2.1 软件功能

设备数字护照溯源管理系统是一套完整的B2B设备管理解决方案，主要包含以下核心功能：

1. **设备数字护照管理**
   - 自动生成唯一护照码
   - 设备全生命周期状态追踪
   - 二维码扫描快速查询

2. **B2B撮合交易平台**
   - 供应商产品发布
   - 采购商需求发布
   - 智能匹配推荐
   - 在线询盘沟通

3. **用户认证管理**
   - 企业注册认证
   - 专家注册认证
   - 多角色权限控制

4. **服务请求管理**
   - 在线服务申请
   - 地图选点定位
   - 附件上传功能

### 2.2 软件特点

- **全流程追溯:** 覆盖设备从采购到售后的完整生命周期
- **智能撮合:** 基于多维度评分算法的买卖匹配
- **灵活部署:** 支持云端部署和本地化部署
- **国际化支持:** 支持中英文双语界面

---

## 3. 运行环境

### 3.1 硬件环境

**服务器端:**
| 配置项 | 最低配置 | 推荐配置 |
|--------|----------|----------|
| CPU | 2核 | 4核及以上 |
| 内存 | 4GB | 8GB及以上 |
| 硬盘 | 50GB SSD | 200GB SSD |
| 网络 | 5Mbps | 10Mbps及以上 |

**客户端:**
| 配置项 | 要求 |
|--------|------|
| 浏览器 | Chrome 90+、Firefox 88+、Edge 90+、Safari 14+ |
| 分辨率 | 1366×768及以上 |
| 网络 | 稳定的互联网连接 |

### 3.2 软件环境

**服务器端:**
| 软件 | 版本 |
|------|------|
| 操作系统 | Ubuntu 22.04 LTS / CentOS 8+ / Windows Server 2019+ |
| Node.js | 18.x 或 20.x LTS |
| PostgreSQL | 14.x 或 16.x |
| Redis | 6.x 或 7.x |
| Nginx | 1.18+ (生产环境) |

**开发环境:**
| 软件 | 版本 |
|------|------|
| pnpm | 8.x 或 9.x |
| TypeScript | 5.x |
| Git | 2.x |

---

## 4. 功能说明

### 4.1 用户认证模块

#### 4.1.1 用户登录

**功能描述:** 已注册用户通过邮箱和密码登录系统。

**输入:**
- 邮箱地址（必填）
- 密码（必填）

**处理流程:**
1. 验证邮箱格式
2. 查询数据库匹配用户
3. 验证密码（BCrypt比对）
4. 生成JWT访问令牌
5. 返回用户信息和令牌

**输出:**
- 成功：返回用户信息、JWT令牌、令牌有效期
- 失败：返回错误信息（邮箱或密码错误）

#### 4.1.2 公司注册

**功能描述:** 企业用户注册为供应商或采购商。

**输入:**
- 基本信息：邮箱、密码、联系人姓名
- 公司信息：公司名称、组织代码（3位字母）
- 角色选择：供应商/采购商（可多选）
- 资质文件：营业执照（上传）

**处理流程:**
1. 验证邮箱唯一性
2. 验证组织代码可用性
3. 创建组织记录
4. 创建用户账号
5. 创建公司档案
6. 关联上传文件
7. 设置状态为"待审核"

**输出:**
- 成功：返回注册成功提示，等待管理员审核
- 失败：返回具体错误信息

#### 4.1.3 专家注册

**功能描述:** 个人专家注册为技术专家或商务专家。

**输入:**
- 账号信息：邮箱、密码
- 专家类型：技术专家/商务专家（可多选）
- 个人信息：姓名、身份证号、手机号
- 专业信息：专业领域、服务内容、从业年限
- 证书上传：简历、资质证书

**处理流程:**
1. 验证邮箱唯一性
2. 创建用户账号
3. 创建专家档案
4. 关联上传文件
5. 设置状态为"待审核"

**输出:**
- 成功：返回注册成功提示
- 失败：返回具体错误信息

### 4.2 设备护照模块

#### 4.2.1 护照码生成

**功能描述:** 为设备生成唯一的数字护照码。

**护照码格式:**
```
DP-{公司代码}-{年份}-{产品线}-{产地}-{序列号}-{校验码}
```

**示例:** `DP-MED-2025-PLC-DE-000001-A7`

**各字段说明:**
| 字段 | 长度 | 说明 |
|------|------|------|
| DP | 2 | 固定前缀，表示Device Passport |
| 公司代码 | 3 | 制造商组织代码 |
| 年份 | 4 | 生产年份 |
| 产品线 | 3 | 产品类型代码 |
| 产地 | 2 | ISO国家代码 |
| 序列号 | 6 | 递增序列号 |
| 校验码 | 2 | 校验位 |

#### 4.2.2 护照创建

**功能描述:** 创建新的设备护照记录。

**输入:**
- 产品类型ID
- 制造商ID
- 供应商信息（可选）
- 设备元数据

**处理流程:**
1. 验证产品类型存在
2. 获取制造商信息
3. 生成护照码
4. 创建护照记录
5. 生成二维码
6. 记录生命周期事件

**输出:**
- 成功：返回完整护照信息
- 失败：返回错误信息

#### 4.2.3 扫码查询

**功能描述:** 通过扫描二维码或输入护照码查询设备信息。

**输入:**
- 护照码

**处理流程:**
1. 验证护照码格式
2. 查询护照记录
3. 根据访问权限返回信息

**输出:**
- 公开访问：返回基本设备信息
- 认证访问：返回完整设备信息和历史记录

### 4.3 B2B撮合模块

#### 4.3.1 产品发布

**功能描述:** 供应商将产品发布到公海市场。

**输入:**
- 产品标题
- 产品描述
- 产品分类
- 价格区间（可选）
- 最小起订量
- 供货地区
- 交货周期

**处理流程:**
1. 验证用户为供应商角色
2. 创建市场产品记录
3. 设置状态为"草稿"或"待审核"
4. 触发匹配引擎

**输出:**
- 成功：返回产品ID
- 失败：返回错误信息

#### 4.3.2 需求发布

**功能描述:** 采购商发布采购需求(RFQ)。

**输入:**
- 需求标题
- 需求描述
- 产品分类
- 采购数量
- 预算范围
- 期望交货日期
- 偏好地区

**处理流程:**
1. 验证用户为采购商角色
2. 创建采购需求记录
3. 设置状态为"开放"
4. 触发匹配引擎

**输出:**
- 成功：返回需求ID
- 失败：返回错误信息

#### 4.3.3 智能匹配

**功能描述:** 自动匹配买卖双方需求。

**匹配算法:**
系统采用多维度加权评分算法：

| 维度 | 权重 | 计算方式 |
|------|------|----------|
| 地理距离 | 25% | 基于经纬度计算距离，距离越近分数越高 |
| 品类匹配 | 20% | 完全匹配20分，相关品类12分 |
| HS编码 | 20% | 6位匹配20分，4位15分，2位10分 |
| 价格兼容 | 15% | 价格区间重叠度 |
| 文本相似 | 10% | 描述文本相似度 |
| 频率匹配 | 10% | 采购频率与供货能力匹配 |

**匹配阈值:**
- 总分 ≥ 50：创建匹配记录
- 总分 ≥ 70：标记为高质量匹配
- 总分 ≥ 85：自动发送通知

#### 4.3.4 询盘沟通

**功能描述:** 买卖双方在线沟通。

**询盘状态流转:**
```
PENDING(待回复) → RESPONDED(已回复) → NEGOTIATING(洽谈中) → ACCEPTED(已成交)/REJECTED(已拒绝)
```

**消息类型:**
| 类型 | 说明 |
|------|------|
| MESSAGE | 普通消息 |
| QUOTE | 报价 |
| COUNTER_OFFER | 还价 |
| ACCEPTANCE | 接受 |
| REJECTION | 拒绝 |

### 4.4 服务请求模块

#### 4.4.1 提交服务请求

**功能描述:** 用户提交设备服务请求。

**输入:**
- 护照码（可选）
- 服务类型
- 问题标题
- 问题描述
- 联系人信息
- 服务地址
- 位置坐标（地图选点）
- 附件文件（可选）

**处理流程:**
1. 验证护照码（如提供）
2. 生成工单编号
3. 创建服务工单
4. 关联附件文件
5. 发送通知

**输出:**
- 成功：返回工单编号
- 失败：返回错误信息

---

## 5. 操作说明

### 5.1 系统访问

1. 打开浏览器
2. 输入系统地址（如：https://your-domain.com）
3. 进入系统首页

### 5.2 用户登录

1. 点击首页右上角"登录"按钮
2. 输入注册邮箱
3. 输入密码
4. 点击"登录"按钮
5. 登录成功后跳转到首页

### 5.3 公司注册

1. 点击首页"注册"按钮
2. 选择"公司注册"
3. 填写账号信息（邮箱、密码）
4. 填写公司基本信息
5. 选择角色（供应商/采购商）
6. 上传营业执照
7. 填写联系人信息
8. 确认并提交
9. 等待管理员审核

### 5.4 发布产品

1. 登录供应商账号
2. 进入"供应商中心"
3. 点击"发布产品"
4. 填写产品信息
5. 设置价格和起订量
6. 上传产品图片
7. 点击"发布"

### 5.5 发布采购需求

1. 登录采购商账号
2. 进入"采购中心"
3. 点击"发布需求"
4. 填写需求信息
5. 设置预算和数量
6. 点击"发布"

### 5.6 发送询盘

1. 在产品列表找到目标产品
2. 点击"询盘"按钮
3. 填写询盘内容
4. 填写需求数量和目标价格
5. 点击"发送"

### 5.7 提交服务请求

1. 进入"服务请求"页面
2. 如无护照码，勾选"我没有设备护照码"
3. 选择服务类型
4. 填写问题描述
5. 上传相关附件（可选）
6. 点击地图选择服务地址
7. 填写联系方式
8. 点击"提交"

---

## 6. 数据字典

### 6.1 用户角色

| 代码 | 名称 | 权限说明 |
|------|------|----------|
| PUBLIC | 公开用户 | 查看公开信息 |
| CUSTOMER | 客户 | 查看设备、提交服务请求 |
| ENGINEER | 工程师 | 执行服务工单 |
| QC_INSPECTOR | 质检员 | 更新质检状态 |
| OPERATOR | 操作员 | 创建设备、管理订单 |
| ADMIN | 管理员 | 系统完全权限 |

### 6.2 设备状态

| 代码 | 名称 | 说明 |
|------|------|------|
| CREATED | 已创建 | 护照已创建 |
| PROCURED | 已采购 | 设备已采购 |
| IN_QC | 质检中 | 正在质检 |
| QC_PASSED | 质检通过 | 质检合格 |
| IN_ASSEMBLY | 组装中 | 正在组装 |
| IN_TESTING | 测试中 | 正在测试 |
| TEST_PASSED | 测试通过 | 测试合格 |
| PACKAGED | 已包装 | 已完成包装 |
| IN_TRANSIT | 运输中 | 正在运输 |
| DELIVERED | 已交付 | 已交付客户 |
| IN_SERVICE | 服务中 | 正在服务使用 |

### 6.3 询盘状态

| 代码 | 名称 | 说明 |
|------|------|------|
| PENDING | 待回复 | 等待供应商回复 |
| RESPONDED | 已回复 | 供应商已回复 |
| NEGOTIATING | 洽谈中 | 双方正在洽谈 |
| ACCEPTED | 已成交 | 达成交易 |
| REJECTED | 已拒绝 | 交易被拒绝 |
| EXPIRED | 已过期 | 询盘已过期 |

### 6.4 产品线代码

| 代码 | 名称 |
|------|------|
| PLC | 可编程逻辑控制器 |
| MOT | 电机/驱动器 |
| SEN | 传感器 |
| CTL | 控制器 |
| ROB | 机器人 |
| HMI | 人机界面 |

---

## 7. 出错处理

### 7.1 常见错误代码

| 错误码 | 含义 | 处理方式 |
|--------|------|----------|
| 400 | 请求参数错误 | 检查输入参数格式 |
| 401 | 未授权 | 请重新登录 |
| 403 | 禁止访问 | 无权限访问该资源 |
| 404 | 资源不存在 | 检查请求地址或ID |
| 500 | 服务器错误 | 联系技术支持 |

### 7.2 登录问题

**问题:** 登录失败，提示"邮箱或密码错误"
**解决:**
1. 确认邮箱输入正确
2. 确认密码输入正确（注意大小写）
3. 如忘记密码，联系管理员重置

**问题:** 登录后被强制退出
**解决:**
1. Token已过期，请重新登录
2. 账号可能在其他设备登录

### 7.3 文件上传问题

**问题:** 文件上传失败
**解决:**
1. 检查文件大小是否超过10MB
2. 检查文件格式是否支持（JPG/PNG/PDF/DOC）
3. 检查网络连接是否稳定

### 7.4 数据保存问题

**问题:** 数据保存失败
**解决:**
1. 检查必填字段是否填写完整
2. 检查网络连接
3. 刷新页面重试

---

## 附录

### A. 技术支持

- 技术支持邮箱：[邮箱地址]
- 技术支持电话：[电话号码]
- 在线文档：[文档地址]

### B. 版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| V1.0 | 2026-01 | 首次发布 |

---

**编写日期:** 2026年1月
**编写人:** [编写人姓名]
**审核人:** [审核人姓名]
